#!/usr/bin/env bash

set -e

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

cd "$PROJECT_ROOT"

# Check if gotestsum is available
if command -v gotestsum &> /dev/null; then
    echo "Using gotestsum to run all tests..."
    gotestsum --raw-command -- ./.gotestsum.sh
else
    echo "Running nanostore tests..."
    go test ./... -v
    
    echo -e "\nRunning todo app tests..."
    cd "$PROJECT_ROOT/examples/apps/todo"
    go test ./... -v
    
    echo -e "\nRunning notes app tests..."
    cd "$PROJECT_ROOT/examples/apps/notes"
    go test ./... -v
    
    # Test Python bindings if Python is available
    if command -v python3 &> /dev/null; then
        echo -e "\nRunning Python binding tests..."
        cd "$PROJECT_ROOT/examples/c-bindings/python"
        python3 tests/test_nanostore.py
    else
        echo -e "\nSkipping Python binding tests (python3 not found)"
    fi
fi