#!/usr/bin/env bash

set -e

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

cd "$PROJECT_ROOT"

# Check if gotestsum is available
if command -v gotestsum &> /dev/null; then
    echo "Using gotestsum to run all tests..."
    gotestsum --raw-command -- ./.gotestsum.sh
else
    echo "Running nanostore tests..."
    go test ./... -v
    
    echo -e "\nRunning todo app tests..."
    cd "$PROJECT_ROOT/examples/apps/todo"
    go test ./... -v
    
    echo -e "\nRunning notes app tests..."
    cd "$PROJECT_ROOT/examples/apps/notes"
    go test ./... -v
fi