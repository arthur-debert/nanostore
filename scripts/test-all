#!/usr/bin/env bash

set -e

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

cd "$PROJECT_ROOT"

# Check if gotestsum is available
if command -v gotestsum &> /dev/null; then
    echo "Using gotestsum..."
    
    # Run nanostore tests
    echo "Running nanostore tests..."
    gotestsum --format testname -- ./... -v
    
    # Run todo app tests
    echo -e "\nRunning todo app tests..."
    cd "$PROJECT_ROOT/examples/apps/todo"
    gotestsum --format testname -- ./... -v
else
    echo "gotestsum not found, using go test..."
    
    # Run nanostore tests
    echo "Running nanostore tests..."
    go test ./... -v
    
    # Run todo app tests  
    echo -e "\nRunning todo app tests..."
    cd "$PROJECT_ROOT/examples/apps/todo"
    go test ./... -v
fi